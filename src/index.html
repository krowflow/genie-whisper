<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Genie Whisper</title>
    <link rel="stylesheet" href="styles/main.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              indigo: {
                950: "#1e1b4b",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-indigo-950 text-white font-sans overflow-hidden">
    <div id="root" class="h-screen"></div>

    <!-- For development, we'll use a simple script to render our app -->
    <!-- In production, this would be replaced with bundled React code -->
    <script>
      // This is a placeholder for the React application
      // In a real build process, this would be replaced with the bundled React code
      document.addEventListener("DOMContentLoaded", () => {
        const root = document.getElementById("root");

        // Create a simple UI that mimics our React components
        root.innerHTML = `
        <div class="h-screen flex flex-col bg-indigo-950">
          <!-- Draggable title bar -->
          <div class="bg-indigo-950 p-2 flex justify-between items-center draggable">
            <div class="flex items-center">
              <h1 class="text-sm font-medium text-gray-400">Genie Whisper</h1>
            </div>
            <div class="flex space-x-2">
              <button id="settings-btn" class="text-gray-400 hover:text-cyan-400" title="Settings" aria-label="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                  <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/>
                </svg>
              </button>
              <button id="minimize-btn" class="text-gray-400 hover:text-cyan-400" title="Minimize" aria-label="Minimize">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M14 8a1 1 0 0 1-1 1H3a1 1 0 0 1 0-2h10a1 1 0 0 1 1 1z"/>
                </svg>
              </button>
              <button id="close-btn" class="text-gray-400 hover:text-red-500" title="Close" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- Main content -->
          <div class="flex-grow flex flex-col p-4">
            <!-- App Title -->
            <div class="text-center mb-4">
              <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 text-transparent bg-clip-text">
                Genie Whisper
              </h1>
              <p class="text-xs text-gray-400">Your Voice-to-Text Assistant</p>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation flex border-b border-indigo-700 mb-4" role="tablist" aria-label="Application tabs">
              <button
                id="main-tab-btn"
                class="px-4 py-2 text-cyan-400 border-b-2 border-cyan-400"
                data-tab="main"
                role="tab"
                aria-selected="true"
                aria-controls="main-tab"
                tabindex="0"
              >
                Main
              </button>
              <button
                id="settings-tab-btn"
                class="px-4 py-2 text-gray-400 hover:text-white"
                data-tab="settings"
                role="tab"
                aria-selected="false"
                aria-controls="settings-tab"
                tabindex="-1"
              >
                Settings
              </button>
              <button
                id="devices-tab-btn"
                class="px-4 py-2 text-gray-400 hover:text-white"
                data-tab="devices"
                role="tab"
                aria-selected="false"
                aria-controls="devices-tab"
                tabindex="-1"
              >
                Devices
              </button>
              <button
                id="help-tab-btn"
                class="px-4 py-2 text-gray-400 hover:text-white"
                data-tab="help"
                role="tab"
                aria-selected="false"
                aria-controls="help-tab"
                tabindex="-1"
              >
                Help
              </button>
            </div>
            
            <!-- Tab Content -->
            <div class="flex-grow flex flex-col">
              <!-- Main Tab -->
              <div id="main-tab" class="flex-grow flex flex-col justify-center" role="tabpanel" aria-labelledby="main-tab-btn" tabindex="0">
              <!-- Waveform with Genie and Mic on sides -->
              <div class="flex items-center justify-between w-full">
                <!-- Genie Avatar on left -->
                <div class="w-1/4 flex justify-center" id="genie-container">
                  <div class="w-40 h-40 flex items-center justify-center genie-container">
                    <style>
                      @keyframes floatAnimation {
                        0% { transform: translateY(0px); }
                        50% { transform: translateY(-5px); }
                        100% { transform: translateY(0px); }
                      }
                      @keyframes glowAnimation {
                        0% { filter: drop-shadow(0 0 3px rgba(6, 182, 212, 0.4)); }
                        50% { filter: drop-shadow(0 0 8px rgba(6, 182, 212, 0.7)); }
                        100% { filter: drop-shadow(0 0 3px rgba(6, 182, 212, 0.4)); }
                      }
                      .genie-container img {
                        animation: floatAnimation 4s ease-in-out infinite, glowAnimation 3s ease-in-out infinite;
                      }
                    </style>
                    <div class="w-40 h-40 relative">
                      <div class="absolute inset-0 rounded-full bg-indigo-900 opacity-0"></div>
                      <img
                        src="Genie.png"
                        alt="Genie"
                        class="w-full h-full object-contain relative z-10"
                        style="mix-blend-mode: screen; filter: drop-shadow(0 0 10px rgba(6, 182, 212, 0.7));"
                      />
                    </div>
                  </div>
                </div>
                
                <!-- Waveform in center -->
                <div class="w-2/4" id="waveform-container">
                  <div class="h-24 rounded bg-transparent flex items-center justify-center space-x-1" id="waveform">
                    <!-- Waveform bars will be generated by JavaScript -->
                  </div>
                </div>
                
                <!-- Microphone button on right -->
                <div class="w-1/4 flex justify-center">
                  <div id="mic-button" class="cursor-pointer">
                    <div class="w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-cyan-400">
                        <path d="M12 15.5C14.21 15.5 16 13.71 16 11.5V6C16 3.79 14.21 2 12 2C9.79 2 8 3.79 8 6V11.5C8 13.71 9.79 15.5 12 15.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4.34998 9.64999V11.35C4.34998 15.57 7.77998 19 12 19C16.22 19 19.65 15.57 19.65 11.35V9.64999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 19V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              </div>
              
              <!-- Settings Tab (hidden by default) -->
              <div id="settings-tab" class="hidden flex-grow p-4" style="max-height: 70vh; overflow-y: auto;" role="tabpanel" aria-labelledby="settings-tab-btn" tabindex="0" aria-hidden="true">
                <h2 class="text-lg font-medium text-white mb-4">Settings</h2>
                
                <!-- General Settings -->
                <div class="mb-6">
                  <h3 class="text-sm font-medium text-cyan-300 mb-3 border-b border-indigo-700 pb-1">
                    General Settings
                  </h3>
                  
                  <div class="mb-3">
                    <label class="flex items-center text-white">
                      <input
                        type="checkbox"
                        id="alwaysOnTop"
                        class="mr-2 bg-indigo-700 border-indigo-600 text-cyan-400 focus:ring-cyan-400"
                        checked
                      />
                      Always on top
                    </label>
                  </div>
                  
                  <div class="mb-3">
                    <label class="flex items-center text-white">
                      <input
                        type="checkbox"
                        id="startMinimized"
                        class="mr-2 bg-indigo-700 border-indigo-600 text-cyan-400 focus:ring-cyan-400"
                      />
                      Start minimized
                    </label>
                  </div>
                  
                  <div class="mb-3">
                    <label class="flex items-center text-white">
                      <input
                        type="checkbox"
                        id="startWithSystem"
                        class="mr-2 bg-indigo-700 border-indigo-600 text-cyan-400 focus:ring-cyan-400"
                        checked
                      />
                      Start with system
                    </label>
                  </div>
                </div>
                
                <!-- Transcription Settings -->
                <div class="mb-6">
                  <h3 class="text-sm font-medium text-cyan-300 mb-3 border-b border-indigo-700 pb-1">
                    Transcription Settings
                  </h3>
                  
                  <div class="mb-3">
                    <label for="modelSize" class="block mb-1 text-sm text-white">Model Size</label>
                    <select
                      id="modelSize"
                      class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                    >
                      <option value="tiny">Tiny (Fast, Less Accurate)</option>
                      <option value="base" selected>Base (Balanced)</option>
                      <option value="small">Small (More Accurate)</option>
                      <option value="medium">Medium (Most Accurate, Slower)</option>
                      <option value="large">Large (Highest Accuracy, Slowest)</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label for="sensitivity" class="block mb-1 text-sm text-white">
                      Sensitivity: <span id="sensitivity-value">0.5</span>
                    </label>
                    <input
                      type="range"
                      id="sensitivity"
                      min="0"
                      max="1"
                      step="0.1"
                      value="0.5"
                      class="w-full"
                    />
                  </div>
                  
                  <div class="mb-3">
                    <label class="flex items-center text-white">
                      <input
                        type="checkbox"
                        id="useVAD"
                        class="mr-2 bg-indigo-700 border-indigo-600 text-cyan-400 focus:ring-cyan-400"
                        checked
                      />
                      Use Voice Activity Detection
                    </label>
                  </div>
                </div>
                
                <!-- Activation Settings -->
                <div class="mb-6">
                  <h3 class="text-sm font-medium text-cyan-300 mb-3 border-b border-indigo-700 pb-1">
                    Activation Settings
                  </h3>
                  
                  <div class="mb-3">
                    <label for="activationMode" class="block mb-1 text-sm text-white">Activation Mode</label>
                    <select
                      id="activationMode"
                      class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                    >
                      <option value="manual" selected>Manual (Hotkey)</option>
                      <option value="wake_word">Wake Word</option>
                      <option value="always_on">Always On</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label for="wakeWord" class="block mb-1 text-sm text-white">Wake Word</label>
                    <input
                      type="text"
                      id="wakeWord"
                      value="Hey Genie"
                      class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                    />
                  </div>
                </div>
                
                <div class="flex justify-end space-x-2 mt-4">
                  <button
                    id="reset-settings-btn"
                    class="bg-indigo-700 hover:bg-indigo-600 text-white font-medium py-1 px-3 rounded"
                  >
                    Reset
                  </button>
                  <button
                    id="save-settings-btn"
                    class="bg-cyan-600 hover:bg-cyan-500 text-white font-medium py-1 px-3 rounded"
                  >
                    Save
                  </button>
                </div>
              </div>
              
              <!-- Devices Tab (hidden by default) -->
              <div id="devices-tab" class="hidden flex-grow p-4" style="max-height: 70vh; overflow-y: auto;" role="tabpanel" aria-labelledby="devices-tab-btn" tabindex="0" aria-hidden="true">
                <h2 class="text-lg font-medium text-white mb-4">Audio Devices</h2>
                
                <div class="mb-4">
                  <label for="deviceSelect" class="block mb-2 text-sm text-white">Select Audio Input Device</label>
                  <select
                    id="deviceSelect"
                    class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                  >
                    <option value="">Default Device</option>
                    <!-- Devices will be populated by JavaScript -->
                  </select>
                </div>
                
                <div class="mt-6">
                  <h3 class="text-sm font-medium text-cyan-300 mb-2">Audio Settings</h3>
                  <div class="space-y-3">
                    <div>
                      <label for="sampleRate" class="block mb-1 text-sm text-white">Sample Rate</label>
                      <select
                        id="sampleRate"
                        class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                      >
                        <option value="16000" selected>16,000 Hz (Recommended for Whisper)</option>
                        <option value="44100">44,100 Hz (CD Quality)</option>
                        <option value="48000">48,000 Hz (Professional Audio)</option>
                      </select>
                    </div>
                    
                    <div>
                      <label for="bufferSize" class="block mb-1 text-sm text-white">Buffer Size</label>
                      <select
                        id="bufferSize"
                        class="w-full bg-indigo-800 text-white rounded p-2 border border-indigo-600 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                      >
                        <option value="256">256 (Lowest Latency, Higher CPU)</option>
                        <option value="512" selected>512 (Balanced)</option>
                        <option value="1024">1024 (Higher Latency, Lower CPU)</option>
                        <option value="2048">2048 (Highest Latency, Lowest CPU)</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="mt-6">
                  <button
                    id="refresh-devices-btn"
                    class="bg-cyan-600 hover:bg-cyan-500 text-white font-medium py-1 px-3 rounded"
                  >
                    Refresh Devices
                  </button>
                </div>
              </div>
              
              <!-- Help Tab (hidden by default) -->
              <div id="help-tab" class="hidden flex-grow p-4" style="max-height: 70vh; overflow-y: auto;" role="tabpanel" aria-labelledby="help-tab-btn" tabindex="0" aria-hidden="true">
                <h2 class="text-lg font-medium text-white mb-4">Genie Whisper Help</h2>
                
                <div class="space-y-6">
                  <section>
                    <h3 class="text-md font-medium text-cyan-300 mb-2">Getting Started</h3>
                    <p class="text-gray-300 mb-2">
                      Genie Whisper is a real-time voice-to-text transcription tool designed to work offline and online,
                      integrating seamlessly with Cursor, VS Code, Roo Code, and Cline Dev.
                    </p>
                    <p class="text-gray-300">
                      To start transcribing, simply click the microphone button or press the configured hotkey
                      (default: Ctrl+Shift+Space).
                    </p>
                  </section>
                  
                  <section>
                    <h3 class="text-md font-medium text-cyan-300 mb-2">Activation Methods</h3>
                    <ul class="list-disc pl-5 text-gray-300 space-y-1">
                      <li><strong>Manual Activation</strong>: Click the microphone button or use the hotkey.</li>
                      <li><strong>Wake Word</strong>: Say "Hey Genie" to activate hands-free (if enabled in settings).</li>
                      <li><strong>Always On</strong>: Continuous transcription (if enabled in settings).</li>
                    </ul>
                  </section>
                  
                  <section>
                    <h3 class="text-md font-medium text-cyan-300 mb-2">Keyboard Shortcuts</h3>
                    <div class="bg-indigo-900 bg-opacity-50 rounded p-3">
                      <table class="w-full text-gray-300">
                        <tbody>
                          <tr>
                            <td class="py-1 pr-4 font-medium">Ctrl+Shift+Space</td>
                            <td>Start/Stop Listening</td>
                          </tr>
                          <tr>
                            <td class="py-1 pr-4 font-medium">Ctrl+,</td>
                            <td>Open Settings</td>
                          </tr>
                          <tr>
                            <td class="py-1 pr-4 font-medium">Ctrl+H</td>
                            <td>Open Help</td>
                          </tr>
                          <tr>
                            <td class="py-1 pr-4 font-medium">Ctrl+D</td>
                            <td>Open Devices</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </section>
                  
                  <section>
                    <h3 class="text-md font-medium text-cyan-300 mb-2">About</h3>
                    <p class="text-gray-300">
                      Genie Whisper v0.1.0<br />
                      Using OpenAI Whisper for transcription<br />
                      © 2025 Genie Whisper Team
                    </p>
                  </section>
                </div>
              </div>
            </div>
            
            <!-- Status text (small and subtle) -->
            <div class="text-center text-xs text-gray-500 mt-4">
              <p id="status">Ready</p>
            </div>
          </div>
        </div>
      `;

        // Create waveform bars
        const waveform = document.getElementById("waveform");
        if (waveform) {
          for (let i = 0; i < 32; i++) {
            const bar = document.createElement("div");
            bar.className = "waveform-bar";

            // Randomly assign cyan or pink color
            const isCyan = Math.random() > 0.2; // 80% chance of cyan
            bar.classList.add(isCyan ? "bg-cyan-400" : "bg-pink-400");

            // Set initial height
            const initialHeight = Math.random() * 20 + 5; // Between 5px and 25px
            bar.style.height = `${initialHeight}px`;

            waveform.appendChild(bar);
          }
        }

        // Tab switching functionality
        const tabButtons = document.querySelectorAll("[data-tab]");
        const tabs = document.querySelectorAll('[id$="-tab"]');

        function switchTab(tabId) {
          try {
            // Validate tabId
            if (!tabId) {
              console.error("Tab ID is required");
              return;
            }

            const targetTab = document.getElementById(`${tabId}-tab`);
            if (!targetTab) {
              console.error(`Tab with ID "${tabId}-tab" not found`);
              return;
            }

            // Hide all tabs
            tabs.forEach((tab) => {
              tab.classList.add("hidden");
              tab.setAttribute("aria-hidden", "true");
            });

            // Show the selected tab
            targetTab.classList.remove("hidden");
            targetTab.setAttribute("aria-hidden", "false");

            // Update active tab button
            tabButtons.forEach((button) => {
              if (button.dataset.tab === tabId) {
                button.classList.add(
                  "text-cyan-400",
                  "border-b-2",
                  "border-cyan-400"
                );
                button.classList.remove("text-gray-400");
                button.setAttribute("aria-selected", "true");
                button.setAttribute("tabindex", "0");
              } else {
                button.classList.remove(
                  "text-cyan-400",
                  "border-b-2",
                  "border-cyan-400"
                );
                button.classList.add("text-gray-400");
                button.setAttribute("aria-selected", "false");
                button.setAttribute("tabindex", "-1");
              }
            });

            // Update status for screen readers
            document.getElementById("status").textContent = `${
              tabId.charAt(0).toUpperCase() + tabId.slice(1)
            } tab selected`;
            setTimeout(() => {
              document.getElementById("status").textContent = "Ready";
            }, 1000);

            // Update document title
            document.title = `Genie Whisper - ${
              tabId.charAt(0).toUpperCase() + tabId.slice(1)
            }`;

            // Log for debugging
            console.log(`Switched to ${tabId} tab`);
          } catch (error) {
            console.error("Error switching tabs:", error);
            document.getElementById("status").textContent =
              "Error switching tabs";
          }
        }

        // Add event listeners to tab buttons
        tabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            switchTab(button.dataset.tab);
          });

          // Add keyboard navigation for accessibility
          button.addEventListener("keydown", (event) => {
            // Handle arrow keys for navigation
            if (event.key === "ArrowRight" || event.key === "ArrowDown") {
              event.preventDefault();
              const nextButton = button.nextElementSibling;
              if (nextButton && nextButton.hasAttribute("data-tab")) {
                nextButton.focus();
                switchTab(nextButton.dataset.tab);
              }
            } else if (event.key === "ArrowLeft" || event.key === "ArrowUp") {
              event.preventDefault();
              const prevButton = button.previousElementSibling;
              if (prevButton && prevButton.hasAttribute("data-tab")) {
                prevButton.focus();
                switchTab(prevButton.dataset.tab);
              }
            } else if (event.key === "Home") {
              event.preventDefault();
              const firstButton = tabButtons[0];
              firstButton.focus();
              switchTab(firstButton.dataset.tab);
            } else if (event.key === "End") {
              event.preventDefault();
              const lastButton = tabButtons[tabButtons.length - 1];
              lastButton.focus();
              switchTab(lastButton.dataset.tab);
            }
          });
        });

        // Add keyboard shortcuts for tabs
        document.addEventListener("keydown", (event) => {
          // Ctrl+1 for Main tab
          if (event.ctrlKey && event.key === "1") {
            switchTab("main");
          }
          // Ctrl+2 for Settings tab
          else if (event.ctrlKey && event.key === "2") {
            switchTab("settings");
          }
          // Ctrl+3 for Devices tab
          else if (event.ctrlKey && event.key === "3") {
            switchTab("devices");
          }
          // Ctrl+4 for Help tab
          else if (event.ctrlKey && event.key === "4") {
            switchTab("help");
          }
          // Ctrl+, for Settings (common shortcut in many apps)
          else if (event.ctrlKey && event.key === ",") {
            switchTab("settings");
          }
          // Ctrl+H for Help
          else if (event.ctrlKey && event.key === "h") {
            switchTab("help");
          }
          // Ctrl+D for Devices
          else if (event.ctrlKey && event.key === "d") {
            switchTab("devices");
          }
        });

        // Add event listeners
        const micButton = document.getElementById("mic-button");
        const genieContainer = document.getElementById("genie-container");
        let isListening = false;

        const toggleListening = () => {
          isListening = !isListening;

          // Update UI based on listening state
          if (isListening) {
            document.body.classList.add("listening");
            document.getElementById("status").textContent = "Listening...";

            // Animate waveform bars
            animateWaveform();

            // Add active class to genie container for special animation
            const genieContainer = document.querySelector(".genie-container");
            if (genieContainer) {
              genieContainer.classList.add("active");
              
              // Add listening animation styles
              const style = document.createElement('style');
              style.id = 'genie-listening-style';
              style.textContent = `
                .genie-container.active img {
                  animation: activePulseAnimation 2s ease-in-out infinite !important;
                  filter: drop-shadow(0 0 20px rgba(6, 182, 212, 1)) !important;
                  mix-blend-mode: screen !important;
                }
                @keyframes activePulseAnimation {
                  0% { transform: translateY(0) scale(1.05); }
                  50% { transform: translateY(-10px) scale(1.2); }
                  100% { transform: translateY(0) scale(1.05); }
                }
              `;
              document.head.appendChild(style);
            }
          } else {
            document.body.classList.remove("listening");
            document.getElementById("status").textContent = "Ready";

            // Stop waveform animation
            if (window.waveformAnimation) {
              cancelAnimationFrame(window.waveformAnimation);
            }

            // Reset waveform bars
            const bars = document.querySelectorAll(".waveform-bar");
            bars.forEach((bar) => {
              bar.style.height = "5px";
            });

            // Remove active class from genie container
            const genieContainer = document.querySelector(".genie-container");
            if (genieContainer) {
              genieContainer.classList.remove("active");
              
              // Remove listening animation styles
              const listeningStyle = document.getElementById('genie-listening-style');
              if (listeningStyle) {
                listeningStyle.remove();
              }
            }
          }
        };

        const animateWaveform = () => {
          const bars = document.querySelectorAll(".waveform-bar");

          const animate = () => {
            bars.forEach((bar) => {
              // Generate random heights for active visualization
              const height = Math.random() * 40 + 5; // Between 5px and 45px
              bar.style.height = `${height}px`;

              // Occasionally change color for some visual interest
              if (Math.random() < 0.05) {
                // 5% chance to change color
                const isCyan = bar.classList.contains("bg-cyan-400");
                if (isCyan) {
                  bar.classList.remove("bg-cyan-400");
                  bar.classList.add("bg-pink-400");
                } else {
                  bar.classList.remove("bg-pink-400");
                  bar.classList.add("bg-cyan-400");
                }
              }
            });

            window.waveformAnimation = requestAnimationFrame(animate);
          };

          animate();
        };

        if (micButton) {
          micButton.addEventListener("click", toggleListening);
        }

        if (genieContainer) {
          genieContainer.addEventListener("click", toggleListening);
        }

        // Handle window controls
        document.getElementById("close-btn")?.addEventListener("click", () => {
          console.log("Close button clicked");
          if (window.api) {
            window.api.send("close-window");
          } else {
            // For development without Electron, simulate window closing
            const root = document.getElementById("root");
            if (root) {
              // Create a simple animation to simulate closing
              root.style.transition = "opacity 0.3s ease-out";
              root.style.opacity = "0";

              setTimeout(() => {
                // Reset after animation
                root.style.opacity = "1";
                document.getElementById("status").textContent =
                  "Window would be hidden in production";
                setTimeout(() => {
                  document.getElementById("status").textContent = "Ready";
                }, 2000);
              }, 300);
            }
          }
        });

        document
          .getElementById("minimize-btn")
          ?.addEventListener("click", () => {
            console.log("Minimize button clicked");
            if (window.api) {
              window.api.send("minimize-window");
            } else {
              // For development without Electron, simulate window minimizing
              const root = document.getElementById("root");
              if (root) {
                // Create a simple animation to simulate minimizing
                root.style.transition =
                  "transform 0.3s ease-out, opacity 0.3s ease-out";
                root.style.transform = "scale(0.8)";
                root.style.opacity = "0.5";

                setTimeout(() => {
                  // Reset after animation
                  root.style.transform = "scale(1)";
                  root.style.opacity = "1";
                  document.getElementById("status").textContent =
                    "Window would be minimized in production";
                  setTimeout(() => {
                    document.getElementById("status").textContent = "Ready";
                  }, 2000);
                }, 300);
              }
            }
          });

        document
          .getElementById("settings-btn")
          ?.addEventListener("click", () => {
            console.log("Settings button clicked");
            switchTab("settings");
            if (window.api) {
              window.api.send("show-settings");
            }
          });

        // Settings form handlers
        document
          .getElementById("save-settings-btn")
          ?.addEventListener("click", () => {
            try {
              // Validate settings before saving
              const settings = {
                alwaysOnTop: document.getElementById("alwaysOnTop").checked,
                startMinimized:
                  document.getElementById("startMinimized").checked,
                startWithSystem:
                  document.getElementById("startWithSystem").checked,
                modelSize: document.getElementById("modelSize").value,
                sensitivity: parseFloat(
                  document.getElementById("sensitivity").value
                ),
                useVAD: document.getElementById("useVAD").checked,
                activationMode: document.getElementById("activationMode").value,
                wakeWord: document.getElementById("wakeWord").value.trim(),
              };

              // Validate wake word if wake word mode is selected
              if (
                settings.activationMode === "wake_word" &&
                !settings.wakeWord
              ) {
                throw new Error(
                  "Wake word is required when wake word activation mode is selected"
                );
              }

              // Validate sensitivity
              if (
                isNaN(settings.sensitivity) ||
                settings.sensitivity < 0 ||
                settings.sensitivity > 1
              ) {
                throw new Error("Sensitivity must be a number between 0 and 1");
              }

              // Save settings logic would go here
              console.log("Saving settings:", settings);

              // In production, we would send these settings to the main process
              if (window.api) {
                window.api.send("update-settings", settings);
              }

              document.getElementById("status").textContent = "Settings saved";
              setTimeout(() => {
                document.getElementById("status").textContent = "Ready";
              }, 2000);
            } catch (error) {
              console.error("Error saving settings:", error);
              document.getElementById(
                "status"
              ).textContent = `Error: ${error.message}`;
              setTimeout(() => {
                document.getElementById("status").textContent = "Ready";
              }, 3000);
            }
          });

        document
          .getElementById("reset-settings-btn")
          ?.addEventListener("click", () => {
            try {
              // Reset settings to defaults
              document.getElementById("alwaysOnTop").checked = true;
              document.getElementById("startMinimized").checked = false;
              document.getElementById("startWithSystem").checked = true;
              document.getElementById("modelSize").value = "base";
              document.getElementById("sensitivity").value = "0.5";
              document.getElementById("sensitivity-value").textContent = "0.5";
              document.getElementById("useVAD").checked = true;
              document.getElementById("activationMode").value = "manual";
              document.getElementById("wakeWord").value = "Hey Genie";

              document.getElementById("status").textContent =
                "Settings reset to defaults";
              setTimeout(() => {
                document.getElementById("status").textContent = "Ready";
              }, 2000);
            } catch (error) {
              console.error("Error resetting settings:", error);
              document.getElementById(
                "status"
              ).textContent = `Error: ${error.message}`;
              setTimeout(() => {
                document.getElementById("status").textContent = "Ready";
              }, 3000);
            }
          });

        // Update sensitivity value display
        const sensitivitySlider = document.getElementById("sensitivity");
        const sensitivityValue = document.getElementById("sensitivity-value");
        if (sensitivitySlider && sensitivityValue) {
          sensitivitySlider.addEventListener("input", () => {
            sensitivityValue.textContent = sensitivitySlider.value;
          });
        }

        // Handle activation mode changes
        const activationModeSelect = document.getElementById("activationMode");
        const wakeWordContainer =
          document.getElementById("wakeWord").parentElement;

        if (activationModeSelect && wakeWordContainer) {
          // Set initial state
          wakeWordContainer.style.opacity =
            activationModeSelect.value === "wake_word" ? "1" : "0.5";
          wakeWordContainer.style.pointerEvents =
            activationModeSelect.value === "wake_word" ? "auto" : "none";

          // Add event listener for changes
          activationModeSelect.addEventListener("change", () => {
            const isWakeWordMode = activationModeSelect.value === "wake_word";

            // Animate the transition
            wakeWordContainer.style.transition = "opacity 0.3s ease";
            wakeWordContainer.style.opacity = isWakeWordMode ? "1" : "0.5";
            wakeWordContainer.style.pointerEvents = isWakeWordMode
              ? "auto"
              : "none";

            // Update status for screen readers
            document.getElementById(
              "status"
            ).textContent = `Activation mode set to ${
              activationModeSelect.options[activationModeSelect.selectedIndex]
                .text
            }`;
            setTimeout(() => {
              document.getElementById("status").textContent = "Ready";
            }, 2000);
          });
        }

        // Refresh devices button
        document
          .getElementById("refresh-devices-btn")
          ?.addEventListener("click", () => {
            try {
              document.getElementById("status").textContent =
                "Refreshing devices...";

              // In a real implementation, we would use the MediaDevices API to get the list of devices
              // For this demo, we'll simulate the process with a timeout
              const deviceSelect = document.getElementById("deviceSelect");

              if (deviceSelect) {
                // Clear existing options except the default
                while (deviceSelect.options.length > 1) {
                  deviceSelect.remove(1);
                }

                // Disable the select while "loading"
                deviceSelect.disabled = true;

                // Simulate loading delay
                setTimeout(() => {
                  try {
                    // In a real implementation, we would enumerate devices using:
                    // navigator.mediaDevices.enumerateDevices()

                    // For demo, add some sample devices
                    const sampleDevices = [
                      { id: "default", label: "Default Microphone" },
                      { id: "built-in", label: "Built-in Microphone" },
                      { id: "usb-mic", label: "USB Microphone" },
                      { id: "focusrite", label: "Focusrite Clarett 4 Pre" },
                      { id: "bluetooth", label: "Bluetooth Headset" },
                    ];

                    // Add the devices to the select
                    sampleDevices.forEach((device) => {
                      const option = document.createElement("option");
                      option.value = device.id;
                      option.text = device.label;
                      deviceSelect.appendChild(option);
                    });

                    // Re-enable the select
                    deviceSelect.disabled = false;

                    // Update status
                    document.getElementById(
                      "status"
                    ).textContent = `Found ${sampleDevices.length} audio devices`;
                    setTimeout(() => {
                      document.getElementById("status").textContent = "Ready";
                    }, 2000);
                  } catch (innerError) {
                    console.error("Error adding devices:", innerError);
                    document.getElementById(
                      "status"
                    ).textContent = `Error: ${innerError.message}`;
                    deviceSelect.disabled = false;
                  }
                }, 1000);
              }
            } catch (error) {
              console.error("Error refreshing devices:", error);
              document.getElementById(
                "status"
              ).textContent = `Error: ${error.message}`;
              setTimeout(() => {
                document.getElementById("status").textContent = "Ready";
              }, 3000);
            }
          });
      });
    </script>
  </body>
</html>
